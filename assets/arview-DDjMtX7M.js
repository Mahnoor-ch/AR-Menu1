import{T as Vt,g as De,h as ft,L as Yt,i as ke,F as ht,j as J,k,C as Q,l as he,m as qt,n as Wt,D as pt,M as Ae,V as I,I as Zt,Q as Te,O as mt,o as Qt,p as Jt,d as ge,q as $t,r as gt,N as en,t as tn,u as nn,v as At,w as sn,R as Fe,x as on,y as rn,e as Tt,z as we,A as an,c as yt,E as cn,J as re,K as ln,B as Et,U as un,a as xt,X as dn,Y as fn,Z as hn,f as bt,G as Re,P as Ue,_ as pn,$ as mn,a0 as gn,a1 as An,a2 as wt,a3 as Tn,a4 as yn,a5 as En,a6 as Je,a7 as xn,a8 as $e,a9 as bn,aa as wn,ab as Rn,ac as He,ad as Ln,ae as Mn,af as oe,ag as ie,ah as et,W as Rt,S as Lt,H as Sn,ai as _n,aj as Nn,ak as In,al as On}from"./three.module-BNuljm8v.js";function tt(f,t){if(t===Vt)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),f;if(t===De||t===ft){let n=f.getIndex();if(n===null){const i=[],a=f.getAttribute("position");if(a!==void 0){for(let r=0;r<a.count;r++)i.push(r);f.setIndex(i),n=f.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),f}const e=n.count-2,s=[];if(t===De)for(let i=1;i<=e;i++)s.push(n.getX(0)),s.push(n.getX(i)),s.push(n.getX(i+1));else for(let i=0;i<e;i++)i%2===0?(s.push(n.getX(i)),s.push(n.getX(i+1)),s.push(n.getX(i+2))):(s.push(n.getX(i+2)),s.push(n.getX(i+1)),s.push(n.getX(i)));s.length/3!==e&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=f.clone();return o.setIndex(s),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),f}class Pn extends Yt{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new Hn(n)}),this.register(function(n){return new zn(n)}),this.register(function(n){return new Vn(n)}),this.register(function(n){return new Yn(n)}),this.register(function(n){return new jn(n)}),this.register(function(n){return new Un(n)}),this.register(function(n){return new Gn(n)}),this.register(function(n){return new Bn(n)}),this.register(function(n){return new Fn(n)}),this.register(function(n){return new Kn(n)}),this.register(function(n){return new vn(n)}),this.register(function(n){return new Xn(n)}),this.register(function(n){return new Dn(n)}),this.register(function(n){return new qn(n)}),this.register(function(n){return new Wn(n)})}load(t,n,e,s){const o=this;let i;this.resourcePath!==""?i=this.resourcePath:this.path!==""?i=this.path:i=ke.extractUrlBase(t),this.manager.itemStart(t);const a=function(c){s?s(c):console.error(c),o.manager.itemError(t),o.manager.itemEnd(t)},r=new ht(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,function(c){try{o.parse(c,i,function(u){n(u),o.manager.itemEnd(t)},a)}catch(u){a(u)}},e,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,n,e,s){let o;const i={},a={},r=new TextDecoder;if(typeof t=="string")o=JSON.parse(t);else if(t instanceof ArrayBuffer)if(r.decode(new Uint8Array(t,0,4))===Mt){try{i[x.KHR_BINARY_GLTF]=new Zn(t)}catch(d){s&&s(d);return}o=JSON.parse(i[x.KHR_BINARY_GLTF].content)}else o=JSON.parse(r.decode(t));else o=t;if(o.asset===void 0||o.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new ls(o,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const d=this.pluginCallbacks[u](c);a[d.name]=d,i[d.name]=!0}if(o.extensionsUsed)for(let u=0;u<o.extensionsUsed.length;++u){const d=o.extensionsUsed[u],h=o.extensionsRequired||[];switch(d){case x.KHR_MATERIALS_UNLIT:i[d]=new kn;break;case x.KHR_DRACO_MESH_COMPRESSION:i[d]=new Qn(o,this.dracoLoader);break;case x.KHR_TEXTURE_TRANSFORM:i[d]=new Jn;break;case x.KHR_MESH_QUANTIZATION:i[d]=new $n;break;default:h.indexOf(d)>=0&&a[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}c.setExtensions(i),c.setPlugins(a),c.parse(e,s)}parseAsync(t,n){const e=this;return new Promise(function(s,o){e.parse(t,n,s,o)})}}function Cn(){let f={};return{get:function(t){return f[t]},add:function(t,n){f[t]=n},remove:function(t){delete f[t]},removeAll:function(){f={}}}}const x={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Dn{constructor(t){this.parser=t,this.name=x.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,n=this.parser.json.nodes||[];for(let e=0,s=n.length;e<s;e++){const o=n[e];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(t){const n=this.parser,e="light:"+t;let s=n.cache.get(e);if(s)return s;const o=n.json,r=((o.extensions&&o.extensions[this.name]||{}).lights||[])[t];let c;const u=new Q(16777215);r.color!==void 0&&u.fromArray(r.color);const d=r.range!==void 0?r.range:0;switch(r.type){case"directional":c=new pt(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Wt(u),c.distance=d;break;case"spot":c=new qt(u),c.distance=d,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,c.angle=r.spot.outerConeAngle,c.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return c.position.set(0,0,0),c.decay=2,W(c,r),r.intensity!==void 0&&(c.intensity=r.intensity),c.name=n.createUniqueName(r.name||"light_"+t),s=Promise.resolve(c),n.cache.add(e,s),s}getDependency(t,n){if(t==="light")return this._loadLight(n)}createNodeAttachment(t){const n=this,e=this.parser,o=e.json.nodes[t],a=(o.extensions&&o.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(r){return e._getNodeRef(n.cache,a,r)})}}class kn{constructor(){this.name=x.KHR_MATERIALS_UNLIT}getMaterialType(){return re}extendParams(t,n,e){const s=[];t.color=new Q(1,1,1),t.opacity=1;const o=n.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const i=o.baseColorFactor;t.color.fromArray(i),t.opacity=i[3]}o.baseColorTexture!==void 0&&s.push(e.assignTexture(t,"map",o.baseColorTexture,he))}return Promise.all(s)}}class Fn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name].emissiveStrength;return o!==void 0&&(n.emissiveIntensity=o),Promise.resolve()}}class Hn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];if(i.clearcoatFactor!==void 0&&(n.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&o.push(e.assignTexture(n,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&o.push(e.assignTexture(n,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(o.push(e.assignTexture(n,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const a=i.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new k(a,a)}return Promise.all(o)}}class vn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];return i.iridescenceFactor!==void 0&&(n.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&o.push(e.assignTexture(n,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(n.iridescenceIOR=i.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&o.push(e.assignTexture(n,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(o)}}class jn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[];n.sheenColor=new Q(0,0,0),n.sheenRoughness=0,n.sheen=1;const i=s.extensions[this.name];return i.sheenColorFactor!==void 0&&n.sheenColor.fromArray(i.sheenColorFactor),i.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&o.push(e.assignTexture(n,"sheenColorMap",i.sheenColorTexture,he)),i.sheenRoughnessTexture!==void 0&&o.push(e.assignTexture(n,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(o)}}class Un{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];return i.transmissionFactor!==void 0&&(n.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&o.push(e.assignTexture(n,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class Gn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];n.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&o.push(e.assignTexture(n,"thicknessMap",i.thicknessTexture)),n.attenuationDistance=i.attenuationDistance||1/0;const a=i.attenuationColor||[1,1,1];return n.attenuationColor=new Q(a[0],a[1],a[2]),Promise.all(o)}}class Bn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=s.extensions[this.name];return n.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class Kn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];n.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&o.push(e.assignTexture(n,"specularIntensityMap",i.specularTexture));const a=i.specularColorFactor||[1,1,1];return n.specularColor=new Q(a[0],a[1],a[2]),i.specularColorTexture!==void 0&&o.push(e.assignTexture(n,"specularColorMap",i.specularColorTexture,he)),Promise.all(o)}}class Xn{constructor(t){this.parser=t,this.name=x.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const e=this.parser.json.materials[t];return!e.extensions||!e.extensions[this.name]?null:J}extendMaterialParams(t,n){const e=this.parser,s=e.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const o=[],i=s.extensions[this.name];return i.anisotropyStrength!==void 0&&(n.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(n.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&o.push(e.assignTexture(n,"anisotropyMap",i.anisotropyTexture)),Promise.all(o)}}class zn{constructor(t){this.parser=t,this.name=x.KHR_TEXTURE_BASISU}loadTexture(t){const n=this.parser,e=n.json,s=e.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const o=s.extensions[this.name],i=n.options.ktx2Loader;if(!i){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(t,o.source,i)}}class Vn{constructor(t){this.parser=t,this.name=x.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const n=this.name,e=this.parser,s=e.json,o=s.textures[t];if(!o.extensions||!o.extensions[n])return null;const i=o.extensions[n],a=s.images[i.source];let r=e.textureLoader;if(a.uri){const c=e.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return e.loadTextureImage(t,i.source,r);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return e.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class Yn{constructor(t){this.parser=t,this.name=x.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const n=this.name,e=this.parser,s=e.json,o=s.textures[t];if(!o.extensions||!o.extensions[n])return null;const i=o.extensions[n],a=s.images[i.source];let r=e.textureLoader;if(a.uri){const c=e.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return e.loadTextureImage(t,i.source,r);if(s.extensionsRequired&&s.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return e.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){t(n.height===1)}})),this.isSupported}}class qn{constructor(t){this.name=x.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const n=this.parser.json,e=n.bufferViews[t];if(e.extensions&&e.extensions[this.name]){const s=e.extensions[this.name],o=this.parser.getDependency("buffer",s.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(a){const r=s.byteOffset||0,c=s.byteLength||0,u=s.count,d=s.byteStride,h=new Uint8Array(a,r,c);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(u,d,h,s.mode,s.filter).then(function(p){return p.buffer}):i.ready.then(function(){const p=new ArrayBuffer(u*d);return i.decodeGltfBuffer(new Uint8Array(p),u,d,h,s.mode,s.filter),p})})}else return null}}class Wn{constructor(t){this.name=x.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const n=this.parser.json,e=n.nodes[t];if(!e.extensions||!e.extensions[this.name]||e.mesh===void 0)return null;const s=n.meshes[e.mesh];for(const c of s.primitives)if(c.mode!==v.TRIANGLES&&c.mode!==v.TRIANGLE_STRIP&&c.mode!==v.TRIANGLE_FAN&&c.mode!==void 0)return null;const i=e.extensions[this.name].attributes,a=[],r={};for(const c in i)a.push(this.parser.getDependency("accessor",i[c]).then(u=>(r[c]=u,r[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(c=>{const u=c.pop(),d=u.isGroup?u.children:[u],h=c[0].count,p=[];for(const T of d){const E=new Ae,g=new I,A=new Te,R=new I(1,1,1),w=new Zt(T.geometry,T.material,h);for(let b=0;b<h;b++)r.TRANSLATION&&g.fromBufferAttribute(r.TRANSLATION,b),r.ROTATION&&A.fromBufferAttribute(r.ROTATION,b),r.SCALE&&R.fromBufferAttribute(r.SCALE,b),w.setMatrixAt(b,E.compose(g,A,R));for(const b in r)b!=="TRANSLATION"&&b!=="ROTATION"&&b!=="SCALE"&&T.geometry.setAttribute(b,r[b]);mt.prototype.copy.call(w,T),this.parser.assignFinalMaterial(w),p.push(w)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const Mt="glTF",fe=12,nt={JSON:1313821514,BIN:5130562};class Zn{constructor(t){this.name=x.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(t,0,fe),e=new TextDecoder;if(this.header={magic:e.decode(new Uint8Array(t.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Mt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-fe,o=new DataView(t,fe);let i=0;for(;i<s;){const a=o.getUint32(i,!0);i+=4;const r=o.getUint32(i,!0);if(i+=4,r===nt.JSON){const c=new Uint8Array(t,fe+i,a);this.content=e.decode(c)}else if(r===nt.BIN){const c=fe+i;this.body=t.slice(c,c+a)}i+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Qn{constructor(t,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=x.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(t,n){const e=this.json,s=this.dracoLoader,o=t.extensions[this.name].bufferView,i=t.extensions[this.name].attributes,a={},r={},c={};for(const u in i){const d=ve[u]||u.toLowerCase();a[d]=i[u]}for(const u in t.attributes){const d=ve[u]||u.toLowerCase();if(i[u]!==void 0){const h=e.accessors[t.attributes[u]],p=ae[h.componentType];c[d]=p.name,r[d]=h.normalized===!0}}return n.getDependency("bufferView",o).then(function(u){return new Promise(function(d){s.decodeDracoFile(u,function(h){for(const p in h.attributes){const T=h.attributes[p],E=r[p];E!==void 0&&(T.normalized=E)}d(h)},a,c)})})}}class Jn{constructor(){this.name=x.KHR_TEXTURE_TRANSFORM}extendTexture(t,n){return(n.texCoord===void 0||n.texCoord===t.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(t=t.clone(),n.texCoord!==void 0&&(t.channel=n.texCoord),n.offset!==void 0&&t.offset.fromArray(n.offset),n.rotation!==void 0&&(t.rotation=n.rotation),n.scale!==void 0&&t.repeat.fromArray(n.scale),t.needsUpdate=!0),t}}class $n{constructor(){this.name=x.KHR_MESH_QUANTIZATION}}class St extends Rn{constructor(t,n,e,s){super(t,n,e,s)}copySampleValue_(t){const n=this.resultBuffer,e=this.sampleValues,s=this.valueSize,o=t*s*3+s;for(let i=0;i!==s;i++)n[i]=e[o+i];return n}interpolate_(t,n,e,s){const o=this.resultBuffer,i=this.sampleValues,a=this.valueSize,r=a*2,c=a*3,u=s-n,d=(e-n)/u,h=d*d,p=h*d,T=t*c,E=T-c,g=-2*p+3*h,A=p-h,R=1-g,w=A-h+d;for(let b=0;b!==a;b++){const y=i[E+b+a],O=i[E+b+r]*u,P=i[T+b+a],D=i[T+b]*u;o[b]=R*y+w*O+g*P+A*D}return o}}const es=new Te;class ts extends St{interpolate_(t,n,e,s){const o=super.interpolate_(t,n,e,s);return es.fromArray(o).normalize().toArray(o),o}}const v={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ae={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},st={9728:sn,9729:At,9984:nn,9985:tn,9986:en,9987:gt},ot={33071:rn,33648:on,10497:Fe},Le={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ve={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},q={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ns={CUBICSPLINE:void 0,LINEAR:wt,STEP:An},Me={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ss(f){return f.DefaultMaterial===void 0&&(f.DefaultMaterial=new yt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:wn})),f.DefaultMaterial}function ee(f,t,n){for(const e in n.extensions)f[e]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[e]=n.extensions[e])}function W(f,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(f.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function os(f,t,n){let e=!1,s=!1,o=!1;for(let c=0,u=t.length;c<u;c++){const d=t[c];if(d.POSITION!==void 0&&(e=!0),d.NORMAL!==void 0&&(s=!0),d.COLOR_0!==void 0&&(o=!0),e&&s&&o)break}if(!e&&!s&&!o)return Promise.resolve(f);const i=[],a=[],r=[];for(let c=0,u=t.length;c<u;c++){const d=t[c];if(e){const h=d.POSITION!==void 0?n.getDependency("accessor",d.POSITION):f.attributes.position;i.push(h)}if(s){const h=d.NORMAL!==void 0?n.getDependency("accessor",d.NORMAL):f.attributes.normal;a.push(h)}if(o){const h=d.COLOR_0!==void 0?n.getDependency("accessor",d.COLOR_0):f.attributes.color;r.push(h)}}return Promise.all([Promise.all(i),Promise.all(a),Promise.all(r)]).then(function(c){const u=c[0],d=c[1],h=c[2];return e&&(f.morphAttributes.position=u),s&&(f.morphAttributes.normal=d),o&&(f.morphAttributes.color=h),f.morphTargetsRelative=!0,f})}function is(f,t){if(f.updateMorphTargets(),t.weights!==void 0)for(let n=0,e=t.weights.length;n<e;n++)f.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){const n=t.extras.targetNames;if(f.morphTargetInfluences.length===n.length){f.morphTargetDictionary={};for(let e=0,s=n.length;e<s;e++)f.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rs(f){let t;const n=f.extensions&&f.extensions[x.KHR_DRACO_MESH_COMPRESSION];if(n?t="draco:"+n.bufferView+":"+n.indices+":"+Se(n.attributes):t=f.indices+":"+Se(f.attributes)+":"+f.mode,f.targets!==void 0)for(let e=0,s=f.targets.length;e<s;e++)t+=":"+Se(f.targets[e]);return t}function Se(f){let t="";const n=Object.keys(f).sort();for(let e=0,s=n.length;e<s;e++)t+=n[e]+":"+f[n[e]]+";";return t}function je(f){switch(f){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function as(f){return f.search(/\.jpe?g($|\?)/i)>0||f.search(/^data\:image\/jpeg/)===0?"image/jpeg":f.search(/\.webp($|\?)/i)>0||f.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const cs=new Ae;class ls{constructor(t={},n={}){this.json=t,this.extensions={},this.plugins={},this.options=n,this.cache=new Cn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let e=!1,s=!1,o=-1;typeof navigator<"u"&&(e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,s=navigator.userAgent.indexOf("Firefox")>-1,o=s?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||e||s&&o<98?this.textureLoader=new Qt(this.options.manager):this.textureLoader=new Jt(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ht(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,n){const e=this,s=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([e.getDependencies("scene"),e.getDependencies("animation"),e.getDependencies("camera")])}).then(function(i){const a={scene:i[0][s.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:s.asset,parser:e,userData:{}};ee(o,a,s),W(a,s),Promise.all(e._invokeAll(function(r){return r.afterRoot&&r.afterRoot(a)})).then(function(){t(a)})}).catch(n)}_markDefs(){const t=this.json.nodes||[],n=this.json.skins||[],e=this.json.meshes||[];for(let s=0,o=n.length;s<o;s++){const i=n[s].joints;for(let a=0,r=i.length;a<r;a++)t[i[a]].isBone=!0}for(let s=0,o=t.length;s<o;s++){const i=t[s];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(e[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(t,n){n!==void 0&&(t.refs[n]===void 0&&(t.refs[n]=t.uses[n]=0),t.refs[n]++)}_getNodeRef(t,n,e){if(t.refs[n]<=1)return e;const s=e.clone(),o=(i,a)=>{const r=this.associations.get(i);r!=null&&this.associations.set(a,r);for(const[c,u]of i.children.entries())o(u,a.children[c])};return o(e,s),s.name+="_instance_"+t.uses[n]++,s}_invokeOne(t){const n=Object.values(this.plugins);n.push(this);for(let e=0;e<n.length;e++){const s=t(n[e]);if(s)return s}return null}_invokeAll(t){const n=Object.values(this.plugins);n.unshift(this);const e=[];for(let s=0;s<n.length;s++){const o=t(n[s]);o&&e.push(o)}return e}getDependency(t,n){const e=t+":"+n;let s=this.cache.get(e);if(!s){switch(t){case"scene":s=this.loadScene(n);break;case"node":s=this._invokeOne(function(o){return o.loadNode&&o.loadNode(n)});break;case"mesh":s=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(n)});break;case"accessor":s=this.loadAccessor(n);break;case"bufferView":s=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(n)});break;case"buffer":s=this.loadBuffer(n);break;case"material":s=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(n)});break;case"texture":s=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(n)});break;case"skin":s=this.loadSkin(n);break;case"animation":s=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(n)});break;case"camera":s=this.loadCamera(n);break;default:if(s=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(t,n)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(e,s)}return s}getDependencies(t){let n=this.cache.get(t);if(!n){const e=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];n=Promise.all(s.map(function(o,i){return e.getDependency(t,i)})),this.cache.add(t,n)}return n}loadBuffer(t){const n=this.json.buffers[t],e=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&t===0)return Promise.resolve(this.extensions[x.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(o,i){e.load(ke.resolveURL(n.uri,s.path),o,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(t){const n=this.json.bufferViews[t];return this.getDependency("buffer",n.buffer).then(function(e){const s=n.byteLength||0,o=n.byteOffset||0;return e.slice(o,o+s)})}loadAccessor(t){const n=this,e=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const i=Le[s.type],a=ae[s.componentType],r=s.normalized===!0,c=new a(s.count*i);return Promise.resolve(new ge(c,i,r))}const o=[];return s.bufferView!==void 0?o.push(this.getDependency("bufferView",s.bufferView)):o.push(null),s.sparse!==void 0&&(o.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(o).then(function(i){const a=i[0],r=Le[s.type],c=ae[s.componentType],u=c.BYTES_PER_ELEMENT,d=u*r,h=s.byteOffset||0,p=s.bufferView!==void 0?e.bufferViews[s.bufferView].byteStride:void 0,T=s.normalized===!0;let E,g;if(p&&p!==d){const A=Math.floor(h/p),R="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+A+":"+s.count;let w=n.cache.get(R);w||(E=new c(a,A*p,s.count*p/u),w=new $t(E,p/u),n.cache.add(R,w)),g=new En(w,r,h%p/u,T)}else a===null?E=new c(s.count*r):E=new c(a,h,s.count*r),g=new ge(E,r,T);if(s.sparse!==void 0){const A=Le.SCALAR,R=ae[s.sparse.indices.componentType],w=s.sparse.indices.byteOffset||0,b=s.sparse.values.byteOffset||0,y=new R(i[1],w,s.sparse.count*A),O=new c(i[2],b,s.sparse.count*r);a!==null&&(g=new ge(g.array.slice(),g.itemSize,g.normalized));for(let P=0,D=y.length;P<D;P++){const H=y[P];if(g.setX(H,O[P*r]),r>=2&&g.setY(H,O[P*r+1]),r>=3&&g.setZ(H,O[P*r+2]),r>=4&&g.setW(H,O[P*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(t){const n=this.json,e=this.options,o=n.textures[t].source,i=n.images[o];let a=this.textureLoader;if(i.uri){const r=e.manager.getHandler(i.uri);r!==null&&(a=r)}return this.loadTextureImage(t,o,a)}loadTextureImage(t,n,e){const s=this,o=this.json,i=o.textures[t],a=o.images[n],r=(a.uri||a.bufferView)+":"+i.sampler;if(this.textureCache[r])return this.textureCache[r];const c=this.loadImageSource(n,e).then(function(u){u.flipY=!1,u.name=i.name||a.name||"",u.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(u.name=a.uri);const h=(o.samplers||{})[i.sampler]||{};return u.magFilter=st[h.magFilter]||At,u.minFilter=st[h.minFilter]||gt,u.wrapS=ot[h.wrapS]||Fe,u.wrapT=ot[h.wrapT]||Fe,s.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[r]=c,c}loadImageSource(t,n){const e=this,s=this.json,o=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(d=>d.clone());const i=s.images[t],a=self.URL||self.webkitURL;let r=i.uri||"",c=!1;if(i.bufferView!==void 0)r=e.getDependency("bufferView",i.bufferView).then(function(d){c=!0;const h=new Blob([d],{type:i.mimeType});return r=a.createObjectURL(h),r});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(r).then(function(d){return new Promise(function(h,p){let T=h;n.isImageBitmapLoader===!0&&(T=function(E){const g=new Je(E);g.needsUpdate=!0,h(g)}),n.load(ke.resolveURL(d,o.path),T,void 0,p)})}).then(function(d){return c===!0&&a.revokeObjectURL(r),d.userData.mimeType=i.mimeType||as(i.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),d});return this.sourceCache[t]=u,u}assignTexture(t,n,e,s){const o=this;return this.getDependency("texture",e.index).then(function(i){if(!i)return null;if(e.texCoord!==void 0&&e.texCoord>0&&(i=i.clone(),i.channel=e.texCoord),o.extensions[x.KHR_TEXTURE_TRANSFORM]){const a=e.extensions!==void 0?e.extensions[x.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const r=o.associations.get(i);i=o.extensions[x.KHR_TEXTURE_TRANSFORM].extendTexture(i,a),o.associations.set(i,r)}}return s!==void 0&&(i.colorSpace=s),t[n]=i,i})}assignFinalMaterial(t){const n=t.geometry;let e=t.material;const s=n.attributes.tangent===void 0,o=n.attributes.color!==void 0,i=n.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+e.uuid;let r=this.cache.get(a);r||(r=new Tt,we.prototype.copy.call(r,e),r.color.copy(e.color),r.map=e.map,r.sizeAttenuation=!1,this.cache.add(a,r)),e=r}else if(t.isLine){const a="LineBasicMaterial:"+e.uuid;let r=this.cache.get(a);r||(r=new an,we.prototype.copy.call(r,e),r.color.copy(e.color),r.map=e.map,this.cache.add(a,r)),e=r}if(s||o||i){let a="ClonedMaterial:"+e.uuid+":";s&&(a+="derivative-tangents:"),o&&(a+="vertex-colors:"),i&&(a+="flat-shading:");let r=this.cache.get(a);r||(r=e.clone(),o&&(r.vertexColors=!0),i&&(r.flatShading=!0),s&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(a,r),this.associations.set(r,this.associations.get(e))),e=r}t.material=e}getMaterialType(){return yt}loadMaterial(t){const n=this,e=this.json,s=this.extensions,o=e.materials[t];let i;const a={},r=o.extensions||{},c=[];if(r[x.KHR_MATERIALS_UNLIT]){const d=s[x.KHR_MATERIALS_UNLIT];i=d.getMaterialType(),c.push(d.extendParams(a,o,n))}else{const d=o.pbrMetallicRoughness||{};if(a.color=new Q(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){const h=d.baseColorFactor;a.color.fromArray(h),a.opacity=h[3]}d.baseColorTexture!==void 0&&c.push(n.assignTexture(a,"map",d.baseColorTexture,he)),a.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,a.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(c.push(n.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(n.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),i=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(t,a)})))}o.doubleSided===!0&&(a.side=cn);const u=o.alphaMode||Me.OPAQUE;if(u===Me.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===Me.MASK&&(a.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&i!==re&&(c.push(n.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new k(1,1),o.normalTexture.scale!==void 0)){const d=o.normalTexture.scale;a.normalScale.set(d,d)}return o.occlusionTexture!==void 0&&i!==re&&(c.push(n.assignTexture(a,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&i!==re&&(a.emissive=new Q().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&i!==re&&c.push(n.assignTexture(a,"emissiveMap",o.emissiveTexture,he)),Promise.all(c).then(function(){const d=new i(a);return o.name&&(d.name=o.name),W(d,o),n.associations.set(d,{materials:t}),o.extensions&&ee(s,d,o),d})}createUniqueName(t){const n=ln.sanitizeNodeName(t||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(t){const n=this,e=this.extensions,s=this.primitiveCache;function o(a){return e[x.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,n).then(function(r){return it(r,a,n)})}const i=[];for(let a=0,r=t.length;a<r;a++){const c=t[a],u=rs(c),d=s[u];if(d)i.push(d.promise);else{let h;c.extensions&&c.extensions[x.KHR_DRACO_MESH_COMPRESSION]?h=o(c):h=it(new Et,c,n),s[u]={primitive:c,promise:h},i.push(h)}}return Promise.all(i)}loadMesh(t){const n=this,e=this.json,s=this.extensions,o=e.meshes[t],i=o.primitives,a=[];for(let r=0,c=i.length;r<c;r++){const u=i[r].material===void 0?ss(this.cache):this.getDependency("material",i[r].material);a.push(u)}return a.push(n.loadGeometries(i)),Promise.all(a).then(function(r){const c=r.slice(0,r.length-1),u=r[r.length-1],d=[];for(let p=0,T=u.length;p<T;p++){const E=u[p],g=i[p];let A;const R=c[p];if(g.mode===v.TRIANGLES||g.mode===v.TRIANGLE_STRIP||g.mode===v.TRIANGLE_FAN||g.mode===void 0)A=o.isSkinnedMesh===!0?new un(E,R):new xt(E,R),A.isSkinnedMesh===!0&&A.normalizeSkinWeights(),g.mode===v.TRIANGLE_STRIP?A.geometry=tt(A.geometry,ft):g.mode===v.TRIANGLE_FAN&&(A.geometry=tt(A.geometry,De));else if(g.mode===v.LINES)A=new dn(E,R);else if(g.mode===v.LINE_STRIP)A=new fn(E,R);else if(g.mode===v.LINE_LOOP)A=new hn(E,R);else if(g.mode===v.POINTS)A=new bt(E,R);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(A.geometry.morphAttributes).length>0&&is(A,o),A.name=n.createUniqueName(o.name||"mesh_"+t),W(A,o),g.extensions&&ee(s,A,g),n.assignFinalMaterial(A),d.push(A)}for(let p=0,T=d.length;p<T;p++)n.associations.set(d[p],{meshes:t,primitives:p});if(d.length===1)return o.extensions&&ee(s,d[0],o),d[0];const h=new Re;o.extensions&&ee(s,h,o),n.associations.set(h,{meshes:t});for(let p=0,T=d.length;p<T;p++)h.add(d[p]);return h})}loadCamera(t){let n;const e=this.json.cameras[t],s=e[e.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return e.type==="perspective"?n=new Ue(pn.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):e.type==="orthographic"&&(n=new mn(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),e.name&&(n.name=this.createUniqueName(e.name)),W(n,e),Promise.resolve(n)}loadSkin(t){const n=this.json.skins[t],e=[];for(let s=0,o=n.joints.length;s<o;s++)e.push(this._loadNodeShallow(n.joints[s]));return n.inverseBindMatrices!==void 0?e.push(this.getDependency("accessor",n.inverseBindMatrices)):e.push(null),Promise.all(e).then(function(s){const o=s.pop(),i=s,a=[],r=[];for(let c=0,u=i.length;c<u;c++){const d=i[c];if(d){a.push(d);const h=new Ae;o!==null&&h.fromArray(o.array,c*16),r.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[c])}return new gn(a,r)})}loadAnimation(t){const e=this.json.animations[t],s=e.name?e.name:"animation_"+t,o=[],i=[],a=[],r=[],c=[];for(let u=0,d=e.channels.length;u<d;u++){const h=e.channels[u],p=e.samplers[h.sampler],T=h.target,E=T.node,g=e.parameters!==void 0?e.parameters[p.input]:p.input,A=e.parameters!==void 0?e.parameters[p.output]:p.output;T.node!==void 0&&(o.push(this.getDependency("node",E)),i.push(this.getDependency("accessor",g)),a.push(this.getDependency("accessor",A)),r.push(p),c.push(T))}return Promise.all([Promise.all(o),Promise.all(i),Promise.all(a),Promise.all(r),Promise.all(c)]).then(function(u){const d=u[0],h=u[1],p=u[2],T=u[3],E=u[4],g=[];for(let A=0,R=d.length;A<R;A++){const w=d[A],b=h[A],y=p[A],O=T[A],P=E[A];if(w===void 0)continue;w.updateMatrix();let D;switch(q[P.path]){case q.weights:D=bn;break;case q.rotation:D=$e;break;case q.position:case q.scale:default:D=xn;break}const H=w.name?w.name:w.uuid,se=O.interpolation!==void 0?ns[O.interpolation]:wt,$=[];q[P.path]===q.weights?w.traverse(function(_){_.morphTargetInfluences&&$.push(_.name?_.name:_.uuid)}):$.push(H);let K=y.array;if(y.normalized){const _=je(K.constructor),V=new Float32Array(K.length);for(let U=0,ue=K.length;U<ue;U++)V[U]=K[U]*_;K=V}for(let _=0,V=$.length;_<V;_++){const U=new D($[_]+"."+q[P.path],b.array,K,se);O.interpolation==="CUBICSPLINE"&&(U.createInterpolant=function(ye){const pe=this instanceof $e?ts:St;return new pe(this.times,this.values,this.getValueSize()/3,ye)},U.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),g.push(U)}}return new Tn(s,void 0,g)})}createNodeMesh(t){const n=this.json,e=this,s=n.nodes[t];return s.mesh===void 0?null:e.getDependency("mesh",s.mesh).then(function(o){const i=e._getNodeRef(e.meshCache,s.mesh,o);return s.weights!==void 0&&i.traverse(function(a){if(a.isMesh)for(let r=0,c=s.weights.length;r<c;r++)a.morphTargetInfluences[r]=s.weights[r]}),i})}loadNode(t){const n=this.json,e=this,s=n.nodes[t],o=e._loadNodeShallow(t),i=[],a=s.children||[];for(let c=0,u=a.length;c<u;c++)i.push(e.getDependency("node",a[c]));const r=s.skin===void 0?Promise.resolve(null):e.getDependency("skin",s.skin);return Promise.all([o,Promise.all(i),r]).then(function(c){const u=c[0],d=c[1],h=c[2];h!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(h,cs)});for(let p=0,T=d.length;p<T;p++)u.add(d[p]);return u})}_loadNodeShallow(t){const n=this.json,e=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const o=n.nodes[t],i=o.name?s.createUniqueName(o.name):"",a=[],r=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(t)});return r&&a.push(r),o.camera!==void 0&&a.push(s.getDependency("camera",o.camera).then(function(c){return s._getNodeRef(s.cameraCache,o.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(t)}).forEach(function(c){a.push(c)}),this.nodeCache[t]=Promise.all(a).then(function(c){let u;if(o.isBone===!0?u=new yn:c.length>1?u=new Re:c.length===1?u=c[0]:u=new mt,u!==c[0])for(let d=0,h=c.length;d<h;d++)u.add(c[d]);if(o.name&&(u.userData.name=o.name,u.name=i),W(u,o),o.extensions&&ee(e,u,o),o.matrix!==void 0){const d=new Ae;d.fromArray(o.matrix),u.applyMatrix4(d)}else o.translation!==void 0&&u.position.fromArray(o.translation),o.rotation!==void 0&&u.quaternion.fromArray(o.rotation),o.scale!==void 0&&u.scale.fromArray(o.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const n=this.extensions,e=this.json.scenes[t],s=this,o=new Re;e.name&&(o.name=s.createUniqueName(e.name)),W(o,e),e.extensions&&ee(n,o,e);const i=e.nodes||[],a=[];for(let r=0,c=i.length;r<c;r++)a.push(s.getDependency("node",i[r]));return Promise.all(a).then(function(r){for(let u=0,d=r.length;u<d;u++)o.add(r[u]);const c=u=>{const d=new Map;for(const[h,p]of s.associations)(h instanceof we||h instanceof Je)&&d.set(h,p);return u.traverse(h=>{const p=s.associations.get(h);p!=null&&d.set(h,p)}),d};return s.associations=c(o),o})}}function us(f,t,n){const e=t.attributes,s=new He;if(e.POSITION!==void 0){const a=n.json.accessors[e.POSITION],r=a.min,c=a.max;if(r!==void 0&&c!==void 0){if(s.set(new I(r[0],r[1],r[2]),new I(c[0],c[1],c[2])),a.normalized){const u=je(ae[a.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=t.targets;if(o!==void 0){const a=new I,r=new I;for(let c=0,u=o.length;c<u;c++){const d=o[c];if(d.POSITION!==void 0){const h=n.json.accessors[d.POSITION],p=h.min,T=h.max;if(p!==void 0&&T!==void 0){if(r.setX(Math.max(Math.abs(p[0]),Math.abs(T[0]))),r.setY(Math.max(Math.abs(p[1]),Math.abs(T[1]))),r.setZ(Math.max(Math.abs(p[2]),Math.abs(T[2]))),h.normalized){const E=je(ae[h.componentType]);r.multiplyScalar(E)}a.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(a)}f.boundingBox=s;const i=new Ln;s.getCenter(i.center),i.radius=s.min.distanceTo(s.max)/2,f.boundingSphere=i}function it(f,t,n){const e=t.attributes,s=[];function o(i,a){return n.getDependency("accessor",i).then(function(r){f.setAttribute(a,r)})}for(const i in e){const a=ve[i]||i.toLowerCase();a in f.attributes||s.push(o(e[i],a))}if(t.indices!==void 0&&!f.index){const i=n.getDependency("accessor",t.indices).then(function(a){f.setIndex(a)});s.push(i)}return W(f,t),us(f,t,n),Promise.all(s).then(function(){return t.targets!==void 0?os(f,t.targets,n):f})}const rt={type:"change"},_e={type:"start"},at={type:"end"};class ds extends Mn{constructor(t,n){super(),this.object=t,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new I,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:oe.ROTATE,MIDDLE:oe.DOLLY,RIGHT:oe.PAN},this.touches={ONE:ie.ROTATE,TWO:ie.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(l){l.addEventListener("keydown",xe),this._domElementKeyEvents=l},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",xe),this._domElementKeyEvents=null},this.saveState=function(){e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=function(){e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(rt),e.update(),o=s.NONE},this.update=(function(){const l=new I,m=new Te().setFromUnitVectors(t.up,new I(0,1,0)),S=m.clone().invert(),N=new I,G=new Te,me=new I,Y=2*Math.PI;return function(){const Qe=e.object.position;l.copy(Qe).sub(e.target),l.applyQuaternion(m),a.setFromVector3(l),e.autoRotate&&o===s.NONE&&H(P()),e.enableDamping?(a.theta+=r.theta*e.dampingFactor,a.phi+=r.phi*e.dampingFactor):(a.theta+=r.theta,a.phi+=r.phi);let X=e.minAzimuthAngle,z=e.maxAzimuthAngle;return isFinite(X)&&isFinite(z)&&(X<-Math.PI?X+=Y:X>Math.PI&&(X-=Y),z<-Math.PI?z+=Y:z>Math.PI&&(z-=Y),X<=z?a.theta=Math.max(X,Math.min(z,a.theta)):a.theta=a.theta>(X+z)/2?Math.max(X,a.theta):Math.min(z,a.theta)),a.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(e.minDistance,Math.min(e.maxDistance,a.radius)),e.enableDamping===!0?e.target.addScaledVector(u,e.dampingFactor):e.target.add(u),l.setFromSpherical(a),l.applyQuaternion(S),Qe.copy(e.target).add(l),e.object.lookAt(e.target),e.enableDamping===!0?(r.theta*=1-e.dampingFactor,r.phi*=1-e.dampingFactor,u.multiplyScalar(1-e.dampingFactor)):(r.set(0,0,0),u.set(0,0,0)),c=1,d||N.distanceToSquared(e.object.position)>i||8*(1-G.dot(e.object.quaternion))>i||me.distanceToSquared(e.target)>0?(e.dispatchEvent(rt),N.copy(e.object.position),G.copy(e.object.quaternion),me.copy(e.target),d=!1,!0):!1}})(),this.dispose=function(){e.domElement.removeEventListener("contextmenu",We),e.domElement.removeEventListener("pointerdown",Ye),e.domElement.removeEventListener("pointercancel",de),e.domElement.removeEventListener("wheel",qe),e.domElement.removeEventListener("pointermove",Ee),e.domElement.removeEventListener("pointerup",de),e._domElementKeyEvents!==null&&(e._domElementKeyEvents.removeEventListener("keydown",xe),e._domElementKeyEvents=null)};const e=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=s.NONE;const i=1e-6,a=new et,r=new et;let c=1;const u=new I;let d=!1;const h=new k,p=new k,T=new k,E=new k,g=new k,A=new k,R=new k,w=new k,b=new k,y=[],O={};function P(){return 2*Math.PI/60/60*e.autoRotateSpeed}function D(){return Math.pow(.95,e.zoomSpeed)}function H(l){r.theta-=l}function se(l){r.phi-=l}const $=(function(){const l=new I;return function(S,N){l.setFromMatrixColumn(N,0),l.multiplyScalar(-S),u.add(l)}})(),K=(function(){const l=new I;return function(S,N){e.screenSpacePanning===!0?l.setFromMatrixColumn(N,1):(l.setFromMatrixColumn(N,0),l.crossVectors(e.object.up,l)),l.multiplyScalar(S),u.add(l)}})(),_=(function(){const l=new I;return function(S,N){const G=e.domElement;if(e.object.isPerspectiveCamera){const me=e.object.position;l.copy(me).sub(e.target);let Y=l.length();Y*=Math.tan(e.object.fov/2*Math.PI/180),$(2*S*Y/G.clientHeight,e.object.matrix),K(2*N*Y/G.clientHeight,e.object.matrix)}else e.object.isOrthographicCamera?($(S*(e.object.right-e.object.left)/e.object.zoom/G.clientWidth,e.object.matrix),K(N*(e.object.top-e.object.bottom)/e.object.zoom/G.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function V(l){e.object.isPerspectiveCamera?c/=l:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom*l)),e.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function U(l){e.object.isPerspectiveCamera?c*=l:e.object.isOrthographicCamera?(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/l)),e.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function ue(l){h.set(l.clientX,l.clientY)}function ye(l){R.set(l.clientX,l.clientY)}function pe(l){E.set(l.clientX,l.clientY)}function Ot(l){p.set(l.clientX,l.clientY),T.subVectors(p,h).multiplyScalar(e.rotateSpeed);const m=e.domElement;H(2*Math.PI*T.x/m.clientHeight),se(2*Math.PI*T.y/m.clientHeight),h.copy(p),e.update()}function Pt(l){w.set(l.clientX,l.clientY),b.subVectors(w,R),b.y>0?V(D()):b.y<0&&U(D()),R.copy(w),e.update()}function Ct(l){g.set(l.clientX,l.clientY),A.subVectors(g,E).multiplyScalar(e.panSpeed),_(A.x,A.y),E.copy(g),e.update()}function Dt(l){l.deltaY<0?U(D()):l.deltaY>0&&V(D()),e.update()}function kt(l){let m=!1;switch(l.code){case e.keys.UP:l.ctrlKey||l.metaKey||l.shiftKey?se(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(0,e.keyPanSpeed),m=!0;break;case e.keys.BOTTOM:l.ctrlKey||l.metaKey||l.shiftKey?se(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(0,-e.keyPanSpeed),m=!0;break;case e.keys.LEFT:l.ctrlKey||l.metaKey||l.shiftKey?H(2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(e.keyPanSpeed,0),m=!0;break;case e.keys.RIGHT:l.ctrlKey||l.metaKey||l.shiftKey?H(-2*Math.PI*e.rotateSpeed/e.domElement.clientHeight):_(-e.keyPanSpeed,0),m=!0;break}m&&(l.preventDefault(),e.update())}function Ge(){if(y.length===1)h.set(y[0].pageX,y[0].pageY);else{const l=.5*(y[0].pageX+y[1].pageX),m=.5*(y[0].pageY+y[1].pageY);h.set(l,m)}}function Be(){if(y.length===1)E.set(y[0].pageX,y[0].pageY);else{const l=.5*(y[0].pageX+y[1].pageX),m=.5*(y[0].pageY+y[1].pageY);E.set(l,m)}}function Ke(){const l=y[0].pageX-y[1].pageX,m=y[0].pageY-y[1].pageY,S=Math.sqrt(l*l+m*m);R.set(0,S)}function Ft(){e.enableZoom&&Ke(),e.enablePan&&Be()}function Ht(){e.enableZoom&&Ke(),e.enableRotate&&Ge()}function Xe(l){if(y.length==1)p.set(l.pageX,l.pageY);else{const S=be(l),N=.5*(l.pageX+S.x),G=.5*(l.pageY+S.y);p.set(N,G)}T.subVectors(p,h).multiplyScalar(e.rotateSpeed);const m=e.domElement;H(2*Math.PI*T.x/m.clientHeight),se(2*Math.PI*T.y/m.clientHeight),h.copy(p)}function ze(l){if(y.length===1)g.set(l.pageX,l.pageY);else{const m=be(l),S=.5*(l.pageX+m.x),N=.5*(l.pageY+m.y);g.set(S,N)}A.subVectors(g,E).multiplyScalar(e.panSpeed),_(A.x,A.y),E.copy(g)}function Ve(l){const m=be(l),S=l.pageX-m.x,N=l.pageY-m.y,G=Math.sqrt(S*S+N*N);w.set(0,G),b.set(0,Math.pow(w.y/R.y,e.zoomSpeed)),V(b.y),R.copy(w)}function vt(l){e.enableZoom&&Ve(l),e.enablePan&&ze(l)}function jt(l){e.enableZoom&&Ve(l),e.enableRotate&&Xe(l)}function Ye(l){e.enabled!==!1&&(y.length===0&&(e.domElement.setPointerCapture(l.pointerId),e.domElement.addEventListener("pointermove",Ee),e.domElement.addEventListener("pointerup",de)),Xt(l),l.pointerType==="touch"?Bt(l):Ut(l))}function Ee(l){e.enabled!==!1&&(l.pointerType==="touch"?Kt(l):Gt(l))}function de(l){zt(l),y.length===0&&(e.domElement.releasePointerCapture(l.pointerId),e.domElement.removeEventListener("pointermove",Ee),e.domElement.removeEventListener("pointerup",de)),e.dispatchEvent(at),o=s.NONE}function Ut(l){let m;switch(l.button){case 0:m=e.mouseButtons.LEFT;break;case 1:m=e.mouseButtons.MIDDLE;break;case 2:m=e.mouseButtons.RIGHT;break;default:m=-1}switch(m){case oe.DOLLY:if(e.enableZoom===!1)return;ye(l),o=s.DOLLY;break;case oe.ROTATE:if(l.ctrlKey||l.metaKey||l.shiftKey){if(e.enablePan===!1)return;pe(l),o=s.PAN}else{if(e.enableRotate===!1)return;ue(l),o=s.ROTATE}break;case oe.PAN:if(l.ctrlKey||l.metaKey||l.shiftKey){if(e.enableRotate===!1)return;ue(l),o=s.ROTATE}else{if(e.enablePan===!1)return;pe(l),o=s.PAN}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(_e)}function Gt(l){switch(o){case s.ROTATE:if(e.enableRotate===!1)return;Ot(l);break;case s.DOLLY:if(e.enableZoom===!1)return;Pt(l);break;case s.PAN:if(e.enablePan===!1)return;Ct(l);break}}function qe(l){e.enabled===!1||e.enableZoom===!1||o!==s.NONE||(l.preventDefault(),e.dispatchEvent(_e),Dt(l),e.dispatchEvent(at))}function xe(l){e.enabled===!1||e.enablePan===!1||kt(l)}function Bt(l){switch(Ze(l),y.length){case 1:switch(e.touches.ONE){case ie.ROTATE:if(e.enableRotate===!1)return;Ge(),o=s.TOUCH_ROTATE;break;case ie.PAN:if(e.enablePan===!1)return;Be(),o=s.TOUCH_PAN;break;default:o=s.NONE}break;case 2:switch(e.touches.TWO){case ie.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;Ft(),o=s.TOUCH_DOLLY_PAN;break;case ie.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;Ht(),o=s.TOUCH_DOLLY_ROTATE;break;default:o=s.NONE}break;default:o=s.NONE}o!==s.NONE&&e.dispatchEvent(_e)}function Kt(l){switch(Ze(l),o){case s.TOUCH_ROTATE:if(e.enableRotate===!1)return;Xe(l),e.update();break;case s.TOUCH_PAN:if(e.enablePan===!1)return;ze(l),e.update();break;case s.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;vt(l),e.update();break;case s.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;jt(l),e.update();break;default:o=s.NONE}}function We(l){e.enabled!==!1&&l.preventDefault()}function Xt(l){y.push(l)}function zt(l){delete O[l.pointerId];for(let m=0;m<y.length;m++)if(y[m].pointerId==l.pointerId){y.splice(m,1);return}}function Ze(l){let m=O[l.pointerId];m===void 0&&(m=new k,O[l.pointerId]=m),m.set(l.pageX,l.pageY)}function be(l){const m=l.pointerId===y[0].pointerId?y[1]:y[0];return O[m.pointerId]}e.domElement.addEventListener("contextmenu",We),e.domElement.addEventListener("pointerdown",Ye),e.domElement.addEventListener("pointercancel",de),e.domElement.addEventListener("wheel",qe,{passive:!1}),this.update()}}let B,te,F,L,C,Ne,ne=!1,Ie=!1,ct=0,lt=1,Oe=0;const j=document.getElementById("arCanvas"),ce=document.getElementById("ar-message"),M=document.createElement("div");M.id="loader-overlay";M.style.position="fixed";M.style.top="0";M.style.left="0";M.style.width="100%";M.style.height="100%";M.style.background="rgba(0,0,0,0.8)";M.style.display="flex";M.style.alignItems="center";M.style.justifyContent="center";M.style.color="#FFD700";M.style.fontSize="1.5em";M.style.zIndex="9999";M.style.transition="opacity 0.3s ease";M.innerText="Loading 3D Model...";document.body.appendChild(M);const fs=new URLSearchParams(window.location.search),Z=fs.get("item")||"pizza",Pe={pizza:{name:"Cheese Pizza",desc:"Cheesy and crispy",price:"Rs. 799"},burger:{name:"Beef Zinger Burger",desc:"Spicy and fresh",price:"Rs. 599"},coffee:{name:"Coffee",desc:"Hot creamy coffee",price:"Rs. 299"}};function le(){return/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)}navigator.xr&&le()?navigator.xr.isSessionSupported("immersive-ar").then(f=>f?hs():Ce()).catch(()=>Ce()):Ce();async function hs(){if(console.log("Starting AR Mode"),F=new Rt({canvas:j,alpha:!0,antialias:!0}),F.xr.enabled=!0,F.setSize(window.innerWidth,window.innerHeight),te=new Ue,B=new Lt,B.add(new Sn(16777215,4473924,1.3)),C=new xt(new _n(.08,.1,32),new re({color:16766720})),C.rotation.x=-Math.PI/2,C.visible=!1,B.add(C),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)try{await navigator.mediaDevices.getUserMedia({video:!0})}catch{alert("Please allow camera access to use AR mode.");return}await _t(),ce.innerText="Tap to Start AR",ce.style.display="block",j.addEventListener("click",async function t(){j.removeEventListener("click",t);const n=await navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test","local"]});F.xr.setSession(n),ce.style.display="none",f(n)}),j.addEventListener("click",()=>{C.visible&&!ne&&ps()}),j.addEventListener("touchstart",t=>{if(!(!ne||!L)&&(t.touches.length===1&&(Ie=!0,Oe=t.touches[0].clientX),t.touches.length===2)){const n=t.touches[0].clientX-t.touches[1].clientX,e=t.touches[0].clientY-t.touches[1].clientY;ct=Math.sqrt(n*n+e*e),lt=L.scale.x}}),j.addEventListener("touchmove",t=>{if(!(!ne||!L)){if(t.touches.length===1&&Ie){const n=t.touches[0].clientX-Oe;L.rotation.y-=n*.01,Oe=t.touches[0].clientX}if(t.touches.length===2){const n=t.touches[0].clientX-t.touches[1].clientX,e=t.touches[0].clientY-t.touches[1].clientY,o=Math.sqrt(n*n+e*e)/ct,i=lt*o;i>.05&&i<5&&L.scale.setScalar(i)}}}),j.addEventListener("touchend",()=>{Ie=!1});async function f(t){const n=await t.requestReferenceSpace("local"),e=await t.requestReferenceSpace("viewer"),s=await t.requestHitTestSource({space:e});F.setAnimationLoop((o,i)=>{if(i&&!ne){const a=i.getHitTestResults(s);if(a.length>0){const r=a[0].getPose(n);C.visible=!0,C.matrix.fromArray(r.transform.matrix),C.matrix.decompose(C.position,C.quaternion,C.scale),C.visible=!0}}F.render(B,F.xr.getCamera())})}}function ps(){L.position.copy(C.position),L.visible=!0,ne=!0,C.visible=!1,ce.style.display="none"}async function _t(){const f=new Pn;return new Promise((t,n)=>{f.load(`./models/${Z}.glb`,e=>{L=e.scene;const s=new He().setFromObject(e.scene),o=new I;s.getSize(o);const i=Math.max(o.x,o.y,o.z),a=le()?.6/i:1.2/i;L=e.scene,L.scale.setScalar(a);const r=new He().setFromObject(L),c=new I;r.getCenter(c),L.position.sub(c),L.position.y-=r.min.y,Z==="coffee"&&L.scale.multiplyScalar(le()?1.3:2.5),Z==="burger"&&L.scale.multiplyScalar(le()?1.1:1.8),L.traverse(u=>{u.isMesh&&(u.castShadow=!0,u.receiveShadow=!0)}),B.add(L),L.visible=!1,M.style.opacity="0",setTimeout(()=>M.style.display="none",500),console.log(" Model loaded successfully:",Z),t()},e=>{M.innerText=`Loading ${Z}... ${(e.loaded/e.total*100).toFixed(0)}%`},e=>{console.error(" Model load error:",e),M.innerText=" Failed to load model. Check file path.",n(e)})})}const ut=new Nn,dt=new k;function Nt(f){if(!L||!te)return;const t=j.getBoundingClientRect(),n=(f.clientX-t.left)/t.width*2-1,e=-((f.clientY-t.top)/t.height)*2+1;dt.set(n,e),ut.setFromCamera(dt,te),ut.intersectObject(L,!0).length>0&&It()}j.addEventListener("click",f=>{le()&&!ne||Nt(f)});j.addEventListener("touchstart",f=>{if(le()&&!ne)return;const t=f.touches[0];Nt({clientX:t.clientX,clientY:t.clientY})});document.querySelector(".close-btn").addEventListener("click",It);function It(){const f=document.querySelector(".info-box");document.getElementById("item-name").textContent=Pe[Z].name,document.getElementById("item-desc").textContent=Pe[Z].desc,document.getElementById("item-price").textContent=Pe[Z].price,f.classList.toggle("hidden")}function ms(){const f=new Et,t=300,n=new Float32Array(t*3);for(let i=0;i<t*3;i++)n[i]=(Math.random()-.5)*10;f.setAttribute("position",new ge(n,3));const e=new Tt({color:65535,size:.035,transparent:!0,opacity:.85}),s=new bt(f,e);s.position.z=-2,B.add(s);function o(){requestAnimationFrame(o),s.rotation.y+=.0015,s.rotation.x+=8e-4}o()}async function Ce(){console.log("3D Viewer Mode"),F=new Rt({canvas:j,antialias:!0}),F.setSize(window.innerWidth,window.innerHeight),F.setClearColor(1052688,1),F.shadowMap.enabled=!0,F.shadowMap.type=In,B=new Lt,B.background=new Q(1052688),ms();const f=new On(16777215,1.2);B.add(f);const t=new pt(16777215,3);t.position.set(2,4,3),t.castShadow=!0,t.shadow.mapSize.width=2048,t.shadow.mapSize.height=2048,B.add(t),te=new Ue(50,window.innerWidth/window.innerHeight,.1,50),te.position.set(0,1.2,3),Ne=new ds(te,j),Ne.enableDamping=!0,await _t(),L.visible=!0;function n(){requestAnimationFrame(n),L&&(L.rotation.y+=.01),Ne.update(),F.render(B,te)}n(),ce.innerText="3D Viewer Mode: Drag to rotate",ce.style.display="block"}
